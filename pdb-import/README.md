# PDB Import

## Introduction

The PDB Import is a Java service used to process files with PDB assemblies, and import xrefs into the Complex Portal database.

## How to run

Run the script [importPdbAssemblies.sh](importPdbAssemblies.sh) to process and import PDB assemblies xrefs into Complex Portal.

By default, this script won't actually make any modifications in the database, it will just generate reports with the
complexes that would be created and updated based on the input data.

To actually import data into the database, change property 'dry.run.mode' in the file
[pdb-import.properties](src/main/resources/META-INF/pdb-import.properties) to false.

### Input arguments

The scripts take the following 6 input arguments:
1. Maven profile
2. IntAct editor username
3. PDB assemblies input file
4. Directory to write report and output files
5. Separator used in the input and output files
6. Boolean to indicate if the input file has a header

### Input file format

The input file is expected to be a tabular file, with a PDB assembly in each row.
Of all the columns in the file, we only care about:
- column 4: complex ids
- column 7: assemblies ids
- column 1: protein ids

## Process

The steps to process and import PDB assemblies xrefs are:
1. Validate and clean input file:
   1. validate and clean UniProt ids or gene
   2. check for duplicate assemblies and merge
2. Process and import:
   1. For each complex
      1. Check the status. We only consider complexes released or ready for release
      2. Iterate through the assemblies to find the assemblies for this complex
         1. If the assembly is linked to the complex, then we add it
         2. If not, and if the complex is predicted, we check the proteins in the assembly and the complex.
            If they match, then it we add it
      3. If any assembly is found, the complex goes to the next step
      4. If no assembly is found, but the complex has existing PDB xrefs, then the complex goes to the next step
   2. For each complex, based on the assemblies found in the previous step:
      1. Assemblies without an xref would be reported as new xrefs to be created
      2. Existing xrefs for assemblies without the right qualifier would be reported for review
      3. Existing xrefs without a matching assembly will be reported for deletion
   3. If not on dry-run mode, changes on the xrefs are saved to the database

## More technical details

For more technical details, check the [Complex Batch Import README](../complex-batch-import/README.md),
containing information about the process to import the xrefs, maven profile needed to run the script,
and output files generated by this service.
