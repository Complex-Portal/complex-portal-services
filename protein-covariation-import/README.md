# Protein Covariation Import

## Introduction

The Protein Covariation Import is a Java service used to process files with protein covariation scores, and import them into the Complex Portal database.

## How to run

Run the script [processAndImportProteinCovariations.sh](processAndImportProteinCovariations.sh) to process and import the protein covariation scores into Complex Portal.

By default, this script won't actually make any modifications in the database, it will just generate reports with the
complexes that would be created and updated based on the input data.

To actually import data into the database, change property 'dry.run.mode' in the file
[protein-covariation-import.properties](src/main/resources/META-INF/protein-covariation-import.properties) to false.

### Input arguments

The scripts take the following 6 input arguments:
1. Maven profile
2. IntAct editor username
3. Covariation scores input file
4. Directory to write report and output files
5. Directory for partitioning?
6. Database id
7. Separator used in the input and output files
8. Boolean to indicate if the input file has a header

### Input file format

The input file is expected to be a tabular file, with protein covariation scores in each row.
Of all the columns in the file, we only care about:
- column 0: protein A (multiple ids)
- column 1: protein B (multiple ids)
- column 5: probability

## Process

The steps to process and import PDB assemblies xrefs are:
1. Pre-process input file:
   1. Iterate through all the complexes and components in the database to save in a file all the proteins part of a complex
   2. Validate and clean UniProt ids from input file
2. Process data in parallel using partitions
   1. For each partition, read protein covariation scores from input file
   2. For each score, check if both proteins are part of a complex
   3. If so, save the scores to a file for the next step
3. Iterate through the saved covariation scores
   1. For each covariation score, ff not on dry-run mode
      1. If it already exists and the probability score has changed, it is updated in the database
      2. If it does not exist, a new entry is created in the database

## More technical details

For more technical details, check the [Complex Batch Import README](../complex-batch-import/README.md),
containing information about the process to import the scores, maven profile needed to run the script,
and output files generated by this service.
